---
- name: setting varibles
  set_fact:
    java_version: 8u411

- name: Download java
  include_role:
    name: artifacts-upload-gcp
    tags:
      - download
    vars:
      artifact: "igot-artifact/infra/java/jdk-{{java_version}}-linux-x64.tar.gz"
      artifact_path: "/tmp/jdk-{{java_version}}-linux-x64.tar.gz"

- name: Uncompressing and copying to system path
  unarchive:
    src: /tmp/jdk-{{java_version}}-linux-x64.tar.gz
    dest: /opt/jdk-{{java_version}}
    remote_src: yes
    keep_newer: yes
  register: tar

- name: Updating java jdk to system path
  shell: |
    update-alternatives --install /usr/bin/java java /opt/jdk-{{java_version}}/bin/java 9999
    update-alternatives --install /usr/bin/javac javac /opt/jdk-{{java_version}}/bin/javac 9999
  when: tar.changed

- name: Checking java version
  shell: java -version
  register: java

- name: Java version
  debug:
    var: java.stderr

